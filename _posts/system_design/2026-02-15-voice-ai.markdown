---
layout: post
title:  "Voice AI"
date:   2026-02-15
category: System Design
tags: system_design
---
<div id="ai-widget-container" style="text-align: center; margin: 40px 0; padding: 20px; border: 1px dashed #ccc; border-radius: 10px; background-color: #fafafa;">
    
    <button id="talkButton" style="
        background-color: #00D1FF; 
        color: white; 
        border: none; 
        padding: 15px 30px; 
        font-size: 18px; 
        font-weight: bold; 
        border-radius: 30px; 
        cursor: pointer; 
        transition: transform 0.2s, background-color 0.2s; 
        box-shadow: 0 4px 15px rgba(0, 209, 255, 0.3);
    ">Start Conversation</button>

    <div id="ai-status" style="margin-top: 15px; color: #666; font-size: 14px; font-family: sans-serif;">
        Ready to connect...
    </div>

</div>

<script type="module">
    // FIXED: Using the correct package '@elevenlabs/client' via esm.sh
    import { Conversation } from 'https://esm.sh/@elevenlabs/client@latest';

    const talkButton = document.getElementById('talkButton');
    const statusDiv = document.getElementById('ai-status');
    let conversation;

    // --- YOUR AGENT ID ---
    const AGENT_ID = 'agent_4601khceyk26ebb9rbdrx4kvbn4b'; 
    // ---------------------

    talkButton.onclick = async () => {
        try {
            if (conversation) {
                await conversation.endSession();
                conversation = null;
                talkButton.innerText = 'Start Conversation';
                statusDiv.innerText = 'Session ended.';
                return;
            }

            talkButton.disabled = true;
            talkButton.innerText = 'Connecting...';
            statusDiv.innerText = 'Requesting microphone access...';
            statusDiv.style.color = '#666';

            // Start the session
            conversation = await Conversation.startSession({
                agentId: AGENT_ID,
                onConnect: () => {
                    talkButton.disabled = false;
                    talkButton.innerText = 'Stop Talking';
                    statusDiv.innerText = 'Connected! Speak now.';
                    statusDiv.style.color = 'green';
                },
                onDisconnect: () => {
                    talkButton.disabled = false;
                    talkButton.innerText = 'Start Conversation';
                    statusDiv.innerText = 'Disconnected.';
                    statusDiv.style.color = '#666';
                    conversation = null;
                },
                onError: (error) => {
                    console.error('Conversation Error:', error);
                    statusDiv.innerText = `Error: ${error}`;
                    statusDiv.style.color = 'red';
                    talkButton.disabled = false;
                    talkButton.innerText = 'Start Conversation';
                },
                onModeChange: (mode) => {
                    // Show if the agent is "speaking" or "listening"
                    statusDiv.innerText = `Agent is ${mode.mode}`; 
                }
            });

        } catch (error) {
            console.error('Connection Failed:', error);
            talkButton.disabled = false;
            talkButton.innerText = 'Start Conversation';
            
            if (error.toString().includes("NotAllowedError")) {
                statusDiv.innerHTML = "Microphone denied. Please allow access.";
            } else {
                statusDiv.innerText = "Connection Failed. Check console.";
            }
            statusDiv.style.color = 'red';
        }
    };
</script>